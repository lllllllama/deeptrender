<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼šè®®æµè§ˆå™¨ - DeepTrender</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
</head>

<body>
    <nav class="navbar">
        <div class="nav-brand">
            <span class="brand-icon">ğŸ”¬</span>
            <span class="brand-text">DeepTrender</span>
        </div>
        <div class="nav-links">
            <a href="/" class="nav-link">é¦–é¡µ</a>
            <a href="/venue.html" class="nav-link">ä¼šè®®åˆ†æ</a>
            <a href="/trends.html" class="nav-link">è¶‹åŠ¿è¿½è¸ª</a>
            <a href="/comparison.html" class="nav-link">ä¼šè®®å¯¹æ¯”</a>
            <a href="/arxiv.html" class="nav-link">arXiv è¶‹åŠ¿</a>
            <a href="/venues-explorer.html" class="nav-link active">ä¼šè®®æµè§ˆå™¨</a>
        </div>
    </nav>

    <main class="container">
        <section class="page-header">
            <h1>ğŸ“š ä¼šè®®æµè§ˆå™¨</h1>
            <p>åŠ¨æ€å‘ç°çš„ AI ä¼šè®®æ•°æ®åº“ï¼ŒæŒ‰é¢†åŸŸå’Œç­‰çº§åˆ†ç±»</p>
        </section>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <section class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸ›ï¸</div>
                <div class="stat-content">
                    <div class="stat-value" id="total-venues">--</div>
                    <div class="stat-label">ä¼šè®®æ€»æ•°</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">â­</div>
                <div class="stat-content">
                    <div class="stat-value" id="tier-a-count">--</div>
                    <div class="stat-label">A çº§ä¼šè®®</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸŒ</div>
                <div class="stat-content">
                    <div class="stat-value" id="domain-count">--</div>
                    <div class="stat-label">é¢†åŸŸæ•°é‡</div>
                </div>
            </div>
            <div class="stat-card action-card" onclick="discoverVenues()">
                <div class="stat-icon">ğŸ”</div>
                <div class="stat-content">
                    <div class="stat-label">å‘ç°æ–°ä¼šè®®</div>
                </div>
            </div>
        </section>

        <!-- ç­›é€‰å™¨ -->
        <section class="filter-bar">
            <div class="filter-group">
                <label>é¢†åŸŸï¼š</label>
                <select id="filter-domain" class="filter-select" onchange="filterVenues()">
                    <option value="">å…¨éƒ¨é¢†åŸŸ</option>
                </select>
            </div>
            <div class="filter-group">
                <label>ç­‰çº§ï¼š</label>
                <select id="filter-tier" class="filter-select" onchange="filterVenues()">
                    <option value="">å…¨éƒ¨ç­‰çº§</option>
                    <option value="A">A çº§</option>
                    <option value="B">B çº§</option>
                    <option value="C">C çº§</option>
                </select>
            </div>
        </section>

        <!-- ä¼šè®®åˆ—è¡¨ -->
        <section class="venues-section">
            <div class="section-header">
                <h2>ä¼šè®®åˆ—è¡¨</h2>
                <span id="venue-count">0 ä¸ªä¼šè®®</span>
            </div>
            <div class="venues-table" id="venues-table">
                <p class="loading">åŠ è½½ä¸­...</p>
            </div>
        </section>

        <!-- é¢†åŸŸåˆ†å¸ƒå›¾ -->
        <section class="chart-card full-width">
            <div class="chart-header">
                <h3>ğŸ“Š é¢†åŸŸåˆ†å¸ƒ</h3>
            </div>
            <div class="chart-body" id="chart-domain" style="height: 400px;"></div>
        </section>
    </main>

    <footer class="footer">
        <p>DeepTrender - AI é¡¶ä¼šè®ºæ–‡å…³é”®è¯è¶‹åŠ¿åˆ†æç³»ç»Ÿ</p>
        <p>æ•°æ®æ¥æº: OpenReview | arXiv</p>
    </footer>

    <script>
        let allVenues = [];
        let filteredVenues = [];

        async function init() {
            await loadVenues();
        }

        async function loadVenues() {
            try {
                const response = await fetch('/api/venues/explorer');
                const data = await response.json();

                allVenues = data.venues;
                filteredVenues = allVenues;

                // æ›´æ–°ç»Ÿè®¡
                document.getElementById('total-venues').textContent = data.total;
                document.getElementById('tier-a-count').textContent =
                    (data.by_tier['A'] || []).length;
                document.getElementById('domain-count').textContent =
                    Object.keys(data.by_domain).length;

                // å¡«å……é¢†åŸŸä¸‹æ‹‰æ¡†
                const domainSelect = document.getElementById('filter-domain');
                Object.keys(data.by_domain).sort().forEach(domain => {
                    const option = document.createElement('option');
                    option.value = domain;
                    option.textContent = `${domain} (${data.by_domain[domain].length})`;
                    domainSelect.appendChild(option);
                });

                // æ¸²æŸ“
                renderVenues(filteredVenues);
                renderDomainChart(data.by_domain);

            } catch (error) {
                console.error('åŠ è½½ä¼šè®®å¤±è´¥:', error);
                document.getElementById('venues-table').innerHTML =
                    '<p class="error">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</p>';
            }
        }

        function filterVenues() {
            const domain = document.getElementById('filter-domain').value;
            const tier = document.getElementById('filter-tier').value;

            filteredVenues = allVenues.filter(v => {
                if (domain && v.domain !== domain) return false;
                if (tier && v.tier !== tier) return false;
                return true;
            });

            renderVenues(filteredVenues);
        }

        function renderVenues(venues) {
            const container = document.getElementById('venues-table');
            document.getElementById('venue-count').textContent = `${venues.length} ä¸ªä¼šè®®`;

            if (venues.length === 0) {
                container.innerHTML = '<p class="no-data">æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ä¼šè®®</p>';
                return;
            }

            let html = '<table class="data-table"><thead><tr>';
            html += '<th>ä¼šè®®</th><th>å…¨ç§°</th><th>é¢†åŸŸ</th><th>ç­‰çº§</th>';
            html += '<th>å¹´ä»½</th><th>è®ºæ–‡æ•°</th></tr></thead><tbody>';

            venues.forEach(v => {
                const tierClass = `tier-${v.tier.toLowerCase()}`;
                const years = v.years.length > 0 ?
                    `${Math.max(...v.years)} - ${Math.min(...v.years)}` : 'N/A';

                html += `<tr>
                    <td><strong>${v.name}</strong></td>
                    <td>${v.full_name}</td>
                    <td><span class="domain-tag">${v.domain}</span></td>
                    <td><span class="tier-badge ${tierClass}">${v.tier}</span></td>
                    <td>${years}</td>
                    <td>${v.paper_count}</td>
                </tr>`;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function renderDomainChart(byDomain) {
            const chart = echarts.init(document.getElementById('chart-domain'));

            const data = Object.entries(byDomain).map(([domain, venues]) => ({
                name: domain,
                value: venues.length
            })).sort((a, b) => b.value - a.value);

            chart.setOption({
                backgroundColor: 'transparent',
                tooltip: { trigger: 'item' },
                legend: {
                    orient: 'vertical',
                    right: 10,
                    top: 'center',
                    textStyle: { color: '#c9d1d9' }
                },
                series: [{
                    name: 'ä¼šè®®æ•°é‡',
                    type: 'pie',
                    radius: ['40%', '70%'],
                    avoidLabelOverlap: true,
                    label: {
                        color: '#c9d1d9',
                        formatter: '{b}: {c} ({d}%)'
                    },
                    data: data,
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]
            });

            window.addEventListener('resize', () => chart.resize());
        }

        async function discoverVenues() {
            if (!confirm('å‘ç°æ–°ä¼šè®®éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ')) return;

            const btn = event.currentTarget;
            btn.classList.add('loading');

            try {
                const response = await fetch('/api/venues/discover', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ min_year: 2022 })
                });

                const result = await response.json();

                if (result.status === 'success') {
                    alert(`å‘ç° ${result.discovered} ä¸ªä¼šè®®å¹´ä»½ï¼Œä¿å­˜ ${result.saved} ä¸ªä¼šè®®ï¼`);
                    location.reload();
                } else {
                    alert(`å‘ç°å¤±è´¥: ${result.message}`);
                }
            } catch (error) {
                alert(`å‘ç°å¤±è´¥: ${error.message}`);
            } finally {
                btn.classList.remove('loading');
            }
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>

    <style>
        .action-card {
            cursor: pointer;
            transition: var(--transition);
        }

        .action-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent);
        }

        .action-card.loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .venues-table {
            margin-top: 1rem;
            overflow-x: auto;
        }

        .domain-tag {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            background: rgba(88, 166, 255, 0.15);
            color: var(--accent);
            border-radius: 12px;
            font-size: 0.85rem;
        }

        .tier-badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .tier-a {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .tier-b {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
        }

        .tier-c {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .section-header h2 {
            font-size: 1.25rem;
        }

        .section-header span {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
    </style>
</body>

</html>