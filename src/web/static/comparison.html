<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼šè®®å¯¹æ¯” - DeepTrender</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
</head>

<body>
    <nav class="navbar">
        <div class="nav-brand">
            <span class="brand-icon">ğŸ”¬</span>
            <span class="brand-text">DeepTrender</span>
        </div>
        <div class="nav-links">
            <a href="/" class="nav-link">é¦–é¡µ</a>
            <a href="/venue.html" class="nav-link">ä¼šè®®åˆ†æ</a>
            <a href="/trends.html" class="nav-link">è¶‹åŠ¿è¿½è¸ª</a>
            <a href="/comparison.html" class="nav-link active">ä¼šè®®å¯¹æ¯”</a>
            <a href="/arxiv.html" class="nav-link">arXiv è¶‹åŠ¿</a>
        </div>
    </nav>

    <main class="container">
        <section class="page-header">
            <h1>ğŸ† ä¼šè®®å¯¹æ¯”åˆ†æ</h1>
            <p>å¯¹æ¯”ä¸åŒä¼šè®®çš„å…³é”®è¯åˆ†å¸ƒï¼Œå‘ç°é¢†åŸŸå·®å¼‚</p>
        </section>

        <!-- å¹´ä»½é€‰æ‹© -->
        <section class="filter-bar">
            <div class="filter-group">
                <label>å¯¹æ¯”å¹´ä»½ï¼š</label>
                <select id="compare-year" class="filter-select"></select>
            </div>
        </section>

        <!-- é›·è¾¾å›¾å¯¹æ¯” -->
        <section class="chart-card full-width">
            <div class="chart-header">
                <h3>ğŸ“Š å…³é”®è¯åˆ†å¸ƒå¯¹æ¯”</h3>
            </div>
            <div class="chart-body" id="chart-radar" style="height: 500px;"></div>
        </section>

        <!-- å¹¶æ’å¯¹æ¯” -->
        <section class="comparison-grid" id="comparison-grid">
            <!-- åŠ¨æ€ç”Ÿæˆ -->
        </section>
    </main>

    <footer class="footer">
        <p>DeepTrender - AI é¡¶ä¼šè®ºæ–‡å…³é”®è¯è¶‹åŠ¿åˆ†æç³»ç»Ÿ</p>
    </footer>

    <script src="/static/js/toast.js"></script>
    <script src="/static/js/api.js"></script>
    <script src="/static/js/charts.js"></script>
    <script>
        async function init() {
            const overview = await API.getOverview();
            const yearSelect = document.getElementById('compare-year');

            // å¡«å……å¹´ä»½
            const years = [...overview.years].sort((a, b) => b - a);
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            });

            yearSelect.addEventListener('change', loadComparison);

            // é»˜è®¤åŠ è½½æœ€æ–°å¹´ä»½
            if (years.length > 0) {
                loadComparison();
            }
        }

        async function loadComparison() {
            const year = parseInt(document.getElementById('compare-year').value);

            try {
                const comparison = await API.getComparison(year, 15);

                // æ¸²æŸ“é›·è¾¾å›¾
                Charts.renderComparisonRadar('chart-radar', comparison);

                // æ¸²æŸ“å¹¶æ’å¯¹æ¯”
                renderComparisonGrid(comparison);

            } catch (error) {
                console.error('åŠ è½½å¯¹æ¯”æ•°æ®å¤±è´¥:', error);
            }
        }

        function renderComparisonGrid(comparison) {
            const grid = document.getElementById('comparison-grid');
            const venues = Object.keys(comparison.venues);

            grid.innerHTML = venues.map(venue => {
                const keywords = comparison.venues[venue];
                const maxCount = keywords.length > 0 ? keywords[0].count : 1;

                return `
                    <div class="comparison-card">
                        <div class="comparison-header">
                            <h3>${venue}</h3>
                            <span class="comparison-year">${comparison.year}</span>
                        </div>
                        <div class="comparison-keywords">
                            ${keywords.slice(0, 10).map((kw, idx) => `
                                <div class="keyword-row">
                                    <span class="keyword-rank">${idx + 1}</span>
                                    <span class="keyword-name">${kw.keyword}</span>
                                    <div class="keyword-bar-container">
                                        <div class="keyword-bar" style="width: ${(kw.count / maxCount * 100)}%"></div>
                                    </div>
                                    <span class="keyword-count">${kw.count}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>

    <style>
        .page-header {
            margin-bottom: 2rem;
        }

        .page-header h1 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }

        .page-header p {
            color: var(--text-secondary);
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .comparison-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .comparison-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-tertiary);
        }

        .comparison-header h3 {
            font-size: 1.1rem;
            color: var(--accent);
        }

        .comparison-year {
            font-size: 0.8rem;
            color: var(--text-muted);
            background: var(--bg-secondary);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .comparison-keywords {
            padding: 1rem;
        }

        .keyword-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .keyword-row:last-child {
            border-bottom: none;
        }

        .keyword-rank {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border-radius: 50%;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .keyword-name {
            flex: 1;
            font-size: 0.875rem;
            color: var(--text-primary);
            min-width: 100px;
        }

        .keyword-bar-container {
            flex: 1;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }

        .keyword-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--gradient-start), var(--gradient-end));
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .keyword-count {
            font-size: 0.8rem;
            color: var(--text-muted);
            min-width: 40px;
            text-align: right;
        }
    </style>
</body>

</html>